<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gerenciamiento de Viajes — Demo</title>
  <!-- Tailwind (Play CDN, desarrollo) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React 18 UMD + ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel (para poder usar JSX en el navegador en modo demo) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body{ background:#0b1324; color:#e6e8ee; }
  </style>
</head>
<body class="min-h-screen p-6">
  <div id="root"></div>

  <script type="text/babel">
  const { useMemo, useRef, useState } = React;

  function App() {
    return (
      <div className="max-w-6xl mx-auto grid gap-6">
        <Header />
        <OrgHeader />
        <TravelForm />
        <Footer />
      </div>
    );
  }

  function Header() {
    return (
      <header className="bg-slate-800/60 backdrop-blur rounded-2xl p-5 shadow-xl border border-slate-700 print:hidden">
        <h1 className="text-2xl font-bold">Gerenciamiento de Viajes — Formulario Interactivo</h1>
        <p className="text-slate-300 text-sm mt-1">Planificá, evaluá riesgos, registrá contactos y firmas. Exportá para imprimir/firmar.</p>
      </header>
    );
  }

  function Section({ title, children, actions, className }) {
    return (
      <section className={"bg-slate-800/60 rounded-2xl p-5 border border-slate-700 shadow-xl print:shadow-none " + (className||"") }>
        <div className="flex items-center justify-between gap-3 mb-3">
          <h2 className="text-lg font-semibold tracking-tight">{title}</h2>
          {actions}
        </div>
        <div className="grid gap-4">{children}</div>
      </section>
    );
  }

  function Field({ label, children, className }) {
    return (
      <label className={"grid gap-1 " + (className || "")}>
        <span className="text-sm text-slate-300">{label}</span>
        {children}
      </label>
    );
  }

  function Input(props) {
    return (
      <input
        {...props}
        className={
          "px-3 py-2 rounded-lg bg-slate-900/60 border border-slate-700 focus:outline-none focus:ring-2 focus:ring-amber-400/60 " +
          (props.className || "")
        }
      />
    );
  }

  function Select({ options, ...props }) {
    return (
      <select
        {...props}
        className="px-3 py-2 rounded-lg bg-slate-900/60 border border-slate-700 focus:outline-none focus:ring-2 focus:ring-amber-400/60"
      >
        {options.map((o) => (
          <option key={o.value} value={o.value}>
            {o.label}
          </option>
        ))}
      </select>
    );
  }

  function TextArea(props) {
    return (
      <textarea
        rows={props.rows || 3}
        {...props}
        className={
          "px-3 py-2 rounded-lg bg-slate-900/60 border border-slate-700 focus:outline-none focus:ring-2 focus:ring-amber-400/60 " +
          (props.className || "")
        }
      />
    );
  }

  function Checkbox({ label, checked, onChange }) {
    return (
      <label className="inline-flex items-center gap-2 select-none">
        <input
          type="checkbox"
          className="w-4 h-4 accent-amber-400"
          checked={checked}
          onChange={(e) => onChange(e.target.checked)}
        />
        <span className="text-sm">{label}</span>
      </label>
    );
  }

  function SignaturePad({ label, width = 520, height = 140, onChange }) {
    const canvasRef = useRef(null);
    const drawing = useRef(false);

    const start = (e) => {
      drawing.current = true;
      const ctx = canvasRef.current.getContext("2d");
      const { x, y } = getPos(e);
      ctx.beginPath();
      ctx.moveTo(x, y);
    };
    const move = (e) => {
      if (!drawing.current) return;
      const ctx = canvasRef.current.getContext("2d");
      const { x, y } = getPos(e);
      ctx.lineTo(x, y);
      ctx.strokeStyle = "#fff";
      ctx.lineWidth = 2;
      ctx.lineCap = "round";
      ctx.lineJoin = "round";
      ctx.stroke();
      onChange?.(canvasRef.current.toDataURL("image/png"));
    };
    const end = () => { drawing.current = false; };
    const clear = () => {
      const ctx = canvasRef.current.getContext("2d");
      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);
      onChange?.("");
    };
    const getPos = (e) => {
      const rect = canvasRef.current.getBoundingClientRect();
      const t = (ev) => ({ x: ev.clientX - rect.left, y: ev.clientY - rect.top });
      if (e.touches && e.touches[0]) return t(e.touches[0]);
      return t(e);
    };

    return (
      <div className="grid gap-2">
        <span className="text-sm text-slate-300">{label}</span>
        <canvas
          ref={canvasRef}
          width={width}
          height={height}
          onMouseDown={start}
          onMouseMove={move}
          onMouseUp={end}
          onMouseLeave={end}
          onTouchStart={start}
          onTouchMove={move}
          onTouchEnd={end}
          className="bg-slate-900/60 border border-slate-700 rounded-xl"
        />
        <button type="button" onClick={clear} className="justify-self-start px-3 py-1.5 rounded-lg bg-slate-700 hover:bg-slate-600 text-sm">
          Limpiar firma
        </button>
      </div>
    );
  }

  function useLocalState(key, initial) {
    const [value, setValue] = useState(() => {
      try { const v = localStorage.getItem(key); return v ? JSON.parse(v) : initial; } catch { return initial; }
    });
    const set = (v) => {
      const nv = typeof v === "function" ? v(value) : v;
      setValue(nv); try { localStorage.setItem(key, JSON.stringify(nv)); } catch {}
    };
    return [value, set];
  }

  function OrgHeader(){
    const [org, setOrg] = useLocalState("org", { empresa: "", direccion: "", telefono: "", email: "", logo: "" });
    const fileRef = useRef(null);

    const onLogo = (e) => {
      const f = e.target.files?.[0]; if(!f) return;
      const r = new FileReader();
      r.onload = () => setOrg({ ...org, logo: String(r.result) });
      r.readAsDataURL(f);
    };

    return (
      <Section title="Membrete / Encabezado de empresa" actions={
        <button type="button" onClick={()=> fileRef.current?.click()} className="px-3 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-sm print:hidden">Cargar logo</button>
      }>
        <input ref={fileRef} className="hidden" type="file" accept="image/*" onChange={onLogo} />
        <div className="grid grid-cols-1 md:grid-cols-[120px_1fr] gap-4 items-center">
          <div className="bg-slate-900/60 border border-slate-700 rounded-xl aspect-[4/3] flex items-center justify-center overflow-hidden">
            {org.logo ? <img src={org.logo} alt="Logo" className="w-full h-full object-contain"/> : <span className="text-xs text-slate-400">Sin logo</span>}
          </div>
          <div className="grid md:grid-cols-2 gap-3">
            <Field label="Empresa"><Input value={org.empresa} onChange={(e)=> setOrg({ ...org, empresa: e.target.value })} placeholder="Nombre legal / comercial" /></Field>
            <Field label="Dirección"><Input value={org.direccion} onChange={(e)=> setOrg({ ...org, direccion: e.target.value })} placeholder="Domicilio" /></Field>
            <Field label="Teléfono"><Input value={org.telefono} onChange={(e)=> setOrg({ ...org, telefono: e.target.value })} placeholder="Ej: +54 9 ..." /></Field>
            <Field label="Email"><Input type="email" value={org.email} onChange={(e)=> setOrg({ ...org, email: e.target.value })} placeholder="contacto@empresa.com" /></Field>
          </div>
        </div>
      </Section>
    );
  }

  function TravelForm() {
    const [plan, setPlan] = useLocalState("plan", {
      fecha: "", horaSalida: "", origen: "", destino: "", motivo: "", ruta: "", duracion: "",
      estadoTiempo: "Seco",
      conductores: [{ nombre: "", tel: "", email: "" }, { nombre: "", tel: "", email: "" }],
      acompanantes: "", empresaVehiculo: "",
      vehiculo: { tipo: "", placa: "", modelo: "", color: "" },
      yaViajoZona: "No",
    });

    const [descansos, setDescansos] = useLocalState("descansos", [ { fecha: "", lugar: "", hora: "", duracion: "" } ]);
    const [contactos, setContactos] = useLocalState("contactos", [ { nombre: "", tel: "", email: "" } ]);

    const [riesgo, setRiesgo] = useLocalState("riesgo", {
      km: "hasta300", clima: "seco", vehiculos: "1v1p", via: "pavimentada", comunicaciones: "celular",
      horasTotales: "lt12", horario: "diaInvierno", fueraTraza: false,
    });

    const puntaje = useMemo(() => {
      let p = 0;
      p += riesgo.km === "hasta300" ? 1 : riesgo.km === "300a600" ? 2 : 5;
      p += riesgo.clima === "seco" ? 2 : riesgo.clima === "llovizna" ? 4 : 8;
      p += riesgo.vehiculos === "1v1p" ? 6 : riesgo.vehiculos === "1v2p" ? 3 : riesgo.vehiculos === "2v1+" ? 2 : 1;
      p += riesgo.via === "pavimentada" ? 1 : riesgo.via === "mixta" ? 2 : riesgo.via === "nopav" ? 4 : 8;
      p += riesgo.comunicaciones === "celular" ? 0 : riesgo.comunicaciones === "tramos" ? 2 : 4;
      p += riesgo.horasTotales === "lt12" ? 0 : riesgo.horasTotales === "lt14" ? 1 : riesgo.horasTotales === "lt16" ? 3 : 999;
      p += riesgo.horario === "noche" ? 8 : 1;
      if (riesgo.fueraTraza) p += 8;
      return p;
    }, [riesgo]);

    const prohibido = riesgo.horasTotales === "gt16" || puntaje >= 999;
    const clasificacion = prohibido ? "NO CONDUCIR" : (puntaje <= 15 ? "RIESGO BAJO" : puntaje <= 22 ? "RIESGO MEDIO" : "RIESGO ALTO");

    const [dj, setDj] = useLocalState("dj", {
      velocidades: false, prohibicionCel: false, licenciaVigente: false, descanso: false,
      planificoDescanso: false, conoceRutas: false, riesgosLocales: false, aptoFisico: false,
    });
    const djOK = Object.values(dj).every(Boolean);

    const [aprob, setAprob] = useLocalState("aprob", { supervisor:false, gerencia:false });
    const reqSup = !prohibido && (clasificacion === "RIESGO MEDIO");
    const reqGer = !prohibido && (clasificacion === "RIESGO ALTO");

    const habilitado = !prohibido && djOK && (
      (!reqSup && !reqGer) || (reqSup && aprob.supervisor) || (reqGer && aprob.gerencia)
    );

    const [firmaC1, setFirmaC1] = useLocalState("firmaC1", "");
    const [firmaC2, setFirmaC2] = useLocalState("firmaC2", "");
    const [firmaSup, setFirmaSup] = useLocalState("firmaSup", "");

    const exportJSON = () => {
      const payload = { plan, descansos, contactos, riesgo, puntaje, clasificacion, dj, aprob, firmas: { firmaC1, firmaC2, firmaSup } };
      const blob = new Blob([JSON.stringify(payload, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = `gerenciamiento_viaje_${Date.now()}.json`; a.click();
      URL.revokeObjectURL(url);
    };

    const fileRef = useRef(null);
    const importJSON = (f) => {
      const file = f?.target?.files?.[0]; if (!file) return;
      const r = new FileReader();
      r.onload = () => {
        try {
          const data = JSON.parse(String(r.result));
          setPlan(data.plan ?? plan);
          setDescansos(data.descansos ?? descansos);
          setContactos(data.contactos ?? contactos);
          setRiesgo(data.riesgo ?? riesgo);
          setDj(data.dj ?? dj);
          setAprob(data.aprob ?? aprob);
          setFirmaC1(data.firmas?.firmaC1 ?? "");
          setFirmaC2(data.firmas?.firmaC2 ?? "");
          setFirmaSup(data.firmas?.firmaSup ?? "");
        } catch (e) { alert("Archivo inválido"); }
      };
      r.readAsText(file);
    };

    const printDoc = () => window.print();

    function StatusBadge(){
      if(prohibido) return <span className="px-3 py-1 rounded-md bg-rose-600/20 text-rose-300 text-sm font-semibold">NO CONDUCIR — &gt; 16 h trabajo + viaje</span>;
      if(!djOK) return <span className="px-3 py-1 rounded-md bg-rose-600/20 text-rose-300 text-sm font-semibold">Falta completar la Declaración Jurada</span>;
      if(reqGer && !aprob.gerencia) return <span className="px-3 py-1 rounded-md bg-amber-500/20 text-amber-300 text-sm font-semibold">Riesgo alto: requiere aprobación de GERENCIA</span>;
      if(reqSup && !aprob.supervisor) return <span className="px-3 py-1 rounded-md bg-amber-500/20 text-amber-300 text-sm font-semibold">Riesgo medio: requiere aprobación de SUPERVISOR</span>;
      return <span className="px-3 py-1 rounded-md bg-emerald-600/20 text-emerald-300 text-sm font-semibold">Habilitado para exportar / imprimir</span>;
    }

    return (
      <form className="grid gap-6">
        <Section title="I. Planificación del viaje">
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <Field label="Fecha"><Input type="date" value={plan.fecha} onChange={(e)=>setPlan({ ...plan, fecha: e.target.value })} /></Field>
            <Field label="Hora de salida"><Input type="time" value={plan.horaSalida} onChange={(e)=>setPlan({ ...plan, horaSalida: e.target.value })} /></Field>
            <Field label="Motivo del viaje"><Input value={plan.motivo} onChange={(e)=>setPlan({ ...plan, motivo: e.target.value })} placeholder="Servicio, mantenimiento, auditoría, etc." /></Field>
          </div>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <Field label="Origen"><Input value={plan.origen} onChange={(e)=>setPlan({ ...plan, origen: e.target.value })} /></Field>
            <Field label="Destino"><Input value={plan.destino} onChange={(e)=>setPlan({ ...plan, destino: e.target.value })} /></Field>
          </div>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <Field label="Ruta a seguir"><TextArea value={plan.ruta} onChange={(e)=>setPlan({ ...plan, ruta: e.target.value })} /></Field>
            <Field label="Duración estimada del viaje"><Input value={plan.duracion} onChange={(e)=>setPlan({ ...plan, duracion: e.target.value })} placeholder="Ej: 6 h 30 min" /></Field>
          </div>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <Field label="Estado del tiempo">
              <Select value={plan.estadoTiempo} onChange={(e)=>setPlan({ ...plan, estadoTiempo: e.target.value })} options={[
                { value: "Seco", label: "Seco" },
                { value: "Lluvia", label: "Lluvia" },
                { value: "Nieve/Heladas", label: "Nieve / Heladas" },
                { value: "Viento", label: "Viento" },
              ]} />
            </Field>
            <Field label="Empresa propietaria del vehículo"><Input value={plan.empresaVehiculo} onChange={(e)=>setPlan({ ...plan, empresaVehiculo: e.target.value })} /></Field>
            <Field label="¿Ha viajado antes a la zona?">
              <Select value={plan.yaViajoZona} onChange={(e)=>setPlan({ ...plan, yaViajoZona: e.target.value })} options={[ { value: "No", label: "No" }, { value: "Si", label: "Sí" } ]} />
            </Field>
          </div>
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
            <Field label="Tipo de vehículo"><Input value={plan.vehiculo.tipo} onChange={(e)=>setPlan({ ...plan, vehiculo: { ...plan.vehiculo, tipo: e.target.value } })} /></Field>
            <Field label="Placa"><Input value={plan.vehiculo.placa} onChange={(e)=>setPlan({ ...plan, vehiculo: { ...plan.vehiculo, placa: e.target.value } })} /></Field>
            <Field label="Modelo"><Input value={plan.vehiculo.modelo} onChange={(e)=>setPlan({ ...plan, vehiculo: { ...plan.vehiculo, modelo: e.target.value } })} /></Field>
            <Field label="Color"><Input value={plan.vehiculo.color} onChange={(e)=>setPlan({ ...plan, vehiculo: { ...plan.vehiculo, color: e.target.value } })} /></Field>
          </div>
          <div className="grid gap-3">
            <div className="font-semibold">Conductores</div>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {plan.conductores.map((c, i) => (
                <div key={i} className="grid gap-2 p-3 rounded-xl border border-slate-700">
                  <Field label={`Conductor ${i+1} — Nombre`}><Input value={c.nombre} onChange={(e)=>{ const cs=[...plan.conductores]; cs[i]={...cs[i], nombre:e.target.value}; setPlan({...plan, conductores:cs}); }} /></Field>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <Field label="Teléfono"><Input value={c.tel} onChange={(e)=>{ const cs=[...plan.conductores]; cs[i]={...cs[i], tel:e.target.value}; setPlan({...plan, conductores:cs}); }} /></Field>
                    <Field label="Email"><Input type="email" value={c.email} onChange={(e)=>{ const cs=[...plan.conductores]; cs[i]={...cs[i], email:e.target.value}; setPlan({...plan, conductores:cs}); }} /></Field>
                  </div>
                </div>
              ))}
            </div>
          </div>
          <Field label="Acompañantes (nombres)"><TextArea value={plan.acompanantes} onChange={(e)=>setPlan({ ...plan, acompanantes: e.target.value })} /></Field>
        </Section>

        <Section title="II. Plan de administración de descanso obligatorio">
          <div className="grid gap-3">
            {descansos.map((d, i)=> (
              <div key={i} className="grid grid-cols-1 md:grid-cols-4 gap-3 border border-slate-700 rounded-xl p-3">
                <Field label="Fecha"><Input type="date" value={d.fecha} onChange={(e)=>{ const ds=[...descansos]; ds[i]={...ds[i], fecha: e.target.value}; setDescansos(ds); }} /></Field>
                <Field label="Lugar de descanso y comunicación"><Input value={d.lugar} onChange={(e)=>{ const ds=[...descansos]; ds[i]={...ds[i], lugar:e.target.value}; setDescansos(ds); }} /></Field>
                <Field label="Hora de comunicación"><Input type="time" value={d.hora} onChange={(e)=>{ const ds=[...descansos]; ds[i]={...ds[i], hora:e.target.value}; setDescansos(ds); }} /></Field>
                <Field label="Duración del descanso"><Input value={d.duracion} onChange={(e)=>{ const ds=[...descansos]; ds[i]={...ds[i], duracion:e.target.value}; setDescansos(ds); }} placeholder="Ej: 30 min" /></Field>
              </div>
            ))}
            <div className="flex gap-2 print:hidden">
              <button type="button" onClick={()=> setDescansos([...descansos, { fecha:"", lugar:"", hora:"", duracion:"" }])} className="px-3 py-1.5 rounded-lg bg-slate-700 hover:bg-slate-600 text-sm">+ Agregar descanso</button>
              {descansos.length>1 && (
                <button type="button" onClick={()=> setDescansos(descansos.slice(0,-1))} className="px-3 py-1.5 rounded-lg bg-slate-700 hover:bg-slate-600 text-sm">– Quitar último</button>
              )}
            </div>
          </div>
        </Section>

        <Section title="III. Análisis de riesgos del viaje" actions={<StatusBadge />}>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <Field label="Km a recorrer (total)">
              <Select value={riesgo.km} onChange={(e)=> setRiesgo({ ...riesgo, km: e.target.value })} options={[ { value:"hasta300", label:"Hasta 300 km (1)" }, { value:"300a600", label:"Entre 300 y 600 km (2)" }, { value:"gt600", label:"> 600 km (5)" }, ]} />
            </Field>
            <Field label="Clima previsto">
              <Select value={riesgo.clima} onChange={(e)=> setRiesgo({ ...riesgo, clima: e.target.value })} options={[ { value:"seco", label:"Seco / normal (2)" }, { value:"llovizna", label:"Lluvia suave (4)" }, { value:"fuerte", label:"Lluvia fuerte / niebla / nieve (8)" }, ]} />
            </Field>
            <Field label="Vehículos y personas">
              <Select value={riesgo.vehiculos} onChange={(e)=> setRiesgo({ ...riesgo, vehiculos: e.target.value })} options={[ { value:"1v1p", label:"1 vehículo con 1 persona (6)" }, { value:"1v2p", label:"1 vehículo con 2+ personas (3)" }, { value:"2v1+", label:"2+ vehículos con 1+ personas (2)" }, { value:"2v2+", label:"2+ vehículos con 2+ personas (1)" }, ]} />
            </Field>
          </div>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <Field label="Condición de la vía">
              <Select value={riesgo.via} onChange={(e)=> setRiesgo({ ...riesgo, via: e.target.value })} options={[ { value:"pavimentada", label:"Pavimentada (1)" }, { value:"mixta", label:"Mixta <50% no pavimentada (2)" }, { value:"nopav", label:"No pavimentada (4)" }, { value:"fueratraza", label:"Fuera de la traza (8)" }, ]} />
            </Field>
            <Field label="Comunicaciones disponibles">
              <Select value={riesgo.comunicaciones} onChange={(e)=> setRiesgo({ ...riesgo, comunicaciones: e.target.value })} options={[ { value:"celular", label:"Teléfono y/o radio (0)" }, { value:"tramos", label:"Tramos sin comunicación (2)" }, { value:"sin", label:"Sin comunicación (4)" }, ]} />
            </Field>
            <Field label="Horas trabajadas + tiempo de viaje">
              <Select value={riesgo.horasTotales} onChange={(e)=> setRiesgo({ ...riesgo, horasTotales: e.target.value })} options={[ { value:"lt12", label:"< 12 h (0)" }, { value:"lt14", label:"< 14 h (1)" }, { value:"lt16", label:"< 16 h (3)" }, { value:"gt16", label:"> 16 h (NO CONDUCIR)" }, ]} />
            </Field>
          </div>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <Field label="Horario del traslado">
              <Select value={riesgo.horario} onChange={(e)=> setRiesgo({ ...riesgo, horario: e.target.value })} options={[ { value:"diaInvierno", label:"Día invierno 8–18 (1)" }, { value:"diaVerano", label:"Día verano 6–20 (1)" }, { value:"noche", label:"Horario nocturno (8)" }, ]} />
            </Field>
            <div className="flex items-end"><Checkbox label="Recorrido fuera de traza requiere Gerencia (+8)" checked={riesgo.fueraTraza} onChange={(v)=> setRiesgo({ ...riesgo, fueraTraza: v })} /></div>
            <div className="grid gap-2 p-3 rounded-xl border border-slate-700">
              <div className="text-sm text-slate-300">Puntaje total</div>
              <div className="text-3xl font-black tracking-tight text-amber-300">{prohibido ? "NO CONDUCIR" : puntaje}</div>
              {!prohibido && (
                <div className={"text-sm font-semibold " + (puntaje<=15?"text-emerald-400": puntaje<=22?"text-yellow-300":"text-rose-400")}>{clasificacion}</div>
              )}
            </div>
          </div>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
            <Checkbox label="Aprobación de Supervisor (requerida si RIESGO MEDIO)" checked={aprob.supervisor} onChange={(v)=> setAprob({ ...aprob, supervisor: v })} />
            <Checkbox label="Aprobación de Gerencia (requerida si RIESGO ALTO)" checked={aprob.gerencia} onChange={(v)=> setAprob({ ...aprob, gerencia: v })} />
          </div>
        </Section>

        <Section title="IV. Declaración jurada de conductor/es (todas deben ser SÍ)">
          <div className="grid sm:grid-cols-2 gap-3">
            <Checkbox label="Conoce las velocidades máximas de la compañía" checked={dj.velocidades} onChange={(v)=> setDj({...dj, velocidades:v})} />
            <Checkbox label="Sabe que está prohibido usar celular mientras conduce" checked={dj.prohibicionCel} onChange={(v)=> setDj({...dj, prohibicionCel:v})} />
            <Checkbox label="Licencia vigente y categoría acorde" checked={dj.licenciaVigente} onChange={(v)=> setDj({...dj, licenciaVigente:v})} />
            <Checkbox label="Durmió ≥ 6 h en las últimas 16 h" checked={dj.descanso} onChange={(v)=> setDj({...dj, descanso:v})} />
            <Checkbox label="Planificó sitios de descanso y reporte" checked={dj.planificoDescanso} onChange={(v)=> setDj({...dj, planificoDescanso:v})} />
            <Checkbox label="Conoce vías/rutas establecidas" checked={dj.conoceRutas} onChange={(v)=> setDj({...dj, conoceRutas:v})} />
            <Checkbox label="Conoce riesgos locales (vía, clima, peatones, animales, etc.)" checked={dj.riesgosLocales} onChange={(v)=> setDj({...dj, riesgosLocales:v})} />
            <Checkbox label="Se encuentra apto físico/anímico, sin alcohol ni drogas" checked={dj.aptoFisico} onChange={(v)=> setDj({...dj, aptoFisico:v})} />
          </div>
          <div className="text-sm mt-2">
            {djOK ? (
              <span className="text-emerald-400 font-semibold">Declaración completa: habilita el viaje sujeto a aprobación de riesgo.</span>
            ) : (
              <span className="text-rose-400 font-semibold">Falta confirmar una o más condiciones — No habilita el viaje.</span>
            )}
          </div>
        </Section>

        <Section title="Contactos (teléfono y email)">
          <div className="grid gap-3">
            {contactos.map((c,i)=> (
              <div key={i} className="grid grid-cols-1 md:grid-cols-3 gap-3 border border-slate-700 rounded-xl p-3">
                <Field label="Nombre"><Input value={c.nombre} onChange={(e)=>{ const cs=[...contactos]; cs[i]={...cs[i], nombre:e.target.value}; setContactos(cs); }} /></Field>
                <Field label="Teléfono"><Input value={c.tel} onChange={(e)=>{ const cs=[...contactos]; cs[i]={...cs[i], tel:e.target.value}; setContactos(cs); }} /></Field>
                <Field label="Email"><Input type="email" value={c.email} onChange={(e)=>{ const cs=[...contactos]; cs[i]={...cs[i], email:e.target.value}; setContactos(cs); }} /></Field>
              </div>
            ))}
            <div className="flex gap-2 print:hidden">
              <button type="button" onClick={()=> setContactos([...contactos, { nombre:"", tel:"", email:"" }])} className="px-3 py-1.5 rounded-lg bg-slate-700 hover:bg-slate-600 text-sm">+ Agregar contacto</button>
              {contactos.length>1 && (
                <button type="button" onClick={()=> setContactos(contactos.slice(0,-1))} className="px-3 py-1.5 rounded-lg bg-slate-700 hover:bg-slate-600 text-sm">– Quitar último</button>
              )}
            </div>
          </div>
        </Section>

        <Section title="Firmas">
          <div className="grid gap-4 md:grid-cols-2">
            <SignaturePad label="Firma y aclaración — Conductor 1" onChange={setFirmaC1} />
            <SignaturePad label="Firma y aclaración — Conductor 2" onChange={setFirmaC2} />
          </div>
          <SignaturePad label="Firma y aclaración — Supervisor / Gerencia" onChange={setFirmaSup} />
        </Section>

        <Section title="Exportar / Importar" actions={
          <div className="flex gap-2 print:hidden items-center">
            <button type="button" onClick={exportJSON} disabled={!habilitado} className={
              "px-3 py-2 rounded-lg font-semibold " + (!habilitado?"bg-slate-700 text-slate-400 cursor-not-allowed":"bg-amber-400 text-slate-900 hover:brightness-95")
            }>Exportar JSON</button>
            <button type="button" onClick={()=> fileRef.current?.click()} className="px-3 py-2 rounded-lg bg-slate-700 hover:bg-slate-600">Importar JSON</button>
            <input ref={fileRef} type="file" accept="application/json" className="hidden" onChange={importJSON} />
            <button type="button" onClick={printDoc} disabled={!habilitado} className={
              "px-3 py-2 rounded-lg font-semibold " + (!habilitado?"bg-slate-700 text-slate-400 cursor-not-allowed":"bg-sky-500 text-slate-900 hover:brightness-95")
            }>Imprimir / Guardar PDF</button>
          </div>
        }>
          <div className="grid gap-2 text-sm text-slate-300">
            <p>Los botones de "Exportar" e "Imprimir" se habilitan solo si: (1) la Declaración Jurada está completa, (2) el puntaje no indica <span className="font-semibold">NO CONDUCIR</span>, y (3) se cuenta con las aprobaciones requeridas según el nivel de riesgo.</p>
            <p className="print:hidden">Sugerencia: usá "Imprimir" y elegí "Guardar como PDF" para generar un archivo con membrete y firmas.</p>
          </div>
        </Section>

        <style>{`
          @media print{
            body{background:white}
            .print\\:hidden{display:none}
            input, select, textarea, button{color:black}
            header{display:none}
            section{break-inside:avoid}
          }
        `}</style>
      </form>
    );
  }

  function Footer(){
    return (
      <footer className="text-center text-xs text-slate-400 pb-6">
        © {new Date().getFullYear()} — Gerenciamiento de Viajes | Uso interno
      </footer>
    );
  }

  ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
